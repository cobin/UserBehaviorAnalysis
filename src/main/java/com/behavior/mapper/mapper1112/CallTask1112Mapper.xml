<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.behavior.mapper.mapper1112.CallTask1112Mapper" >  
  <parameterMap type="Map" id="proIndex">
  <parameter property="Opid" jdbcType="INTEGER" mode="IN" javaType="java.lang.Integer"/> 
  <parameter property="sDate" jdbcType="VARCHAR" mode="IN" javaType="java.lang.String"/> 
  <parameter property="errMsg" jdbcType="VARCHAR" mode="OUT" javaType="java.lang.String"/> 
  </parameterMap>
  <update id="updateSmallSingleCompare" parameterMap="proIndex" statementType="CALLABLE" >  
  {call BD_UserNT.dbo.P_SmallSingleWeb_Experiment_Source_Statistics_Scheduler(?,?, ?)}
  </update>  
  <select id="queryMonitorWapPcAdept" parameterType="Map" resultType="Map">
  
	DECLARE @startDate INT=20190701
		,@lastDate INT =20190719
	DECLARE @actId INT = 107
	
	SELECT  @actId = MIN(actId) ,
	        @startDate = CONVERT(VARCHAR, MIN(startDate), 112) ,
	        @lastDate = CONVERT(VARCHAR, MIN(EndDate), 112)
	FROM    [DB_WebNerveData].[dbo].[_Mission_Act_Info]
	WHERE   actType = 1
	        AND CAST(GETDATE() AS DATE) BETWEEN startdate AND EndDate
	        AND actId IN ( SELECT DISTINCT
	                                Actid
	                       FROM     DB_CompanyData.dbo._NewBieUserSource );
  	DECLARE @tPerson TABLE (regionType INT ,regionCenter INT ,deptId INT)
	INSERT INTO @tPerson
	SELECT DISTINCT
	        a.RegionType,a.RegionCenter,a.ADeptId  		      
	FROM    DB_CompanyData.dbo.[_Human_Person_Salers_snapshot] a
	WHERE   a.Sdate &lt;= @lastDate
	        AND a.Sdate >= @startDate
	        AND bMainPosition = 1
	        AND isValid = 1
	        AND (
	        	RegionType in(${regionTypes})
	        	OR
	        	ADeptId in(${regionTypes})
	        	)	        
	
	SELECT DISTINCT deptId FROM @tPerson
	UNION
	SELECT DISTINCT regionType FROM @tPerson
	UNION
	SELECT DISTINCT RegionCenter FROM @tPerson
	UNION
	SELECT 0 AS company 
	
  </select>
  
  <parameterMap type="Map" id="proIndex1">
  <parameter property="Opid" jdbcType="INTEGER" mode="IN" javaType="java.lang.Integer"/> 
  <parameter property="sDate" jdbcType="VARCHAR" mode="IN" javaType="java.lang.String"/> 
  <parameter property="unitId" jdbcType="INTEGER" mode="IN" javaType="java.lang.Integer"/> 
  <parameter property="errMsg" jdbcType="VARCHAR" mode="OUT" javaType="java.lang.String"/> 
  </parameterMap>
  <update id="updateMonitorWapPc" parameterMap="proIndex1" statementType="CALLABLE" >  
  {call BD_UserNT.dbo.P_SalesOverallReport_OverallReport360_WapPc_Monitor_Scheduler(?,?,?, ?)}
  </update> 
</mapper>